#!/usr/bin/env node

// speed up `gluegun --version` et al
if (['v', 'version', '-v', '--v', '-version', '--version'].includes(process.argv[2])) {
  var contents = require('fs').readFileSync(__dirname + '/../package.json')
  var package = JSON.parse(contents)
  console.log(package.version)
  process.exit(0)
}

// check if we're running in dev mode
var devMode = require('fs').existsSync(`${__dirname}/../src`)
var wantsCompiled = process.argv.indexOf('--compiled-gluegun') >= 0

if (devMode && !wantsCompiled) {
  if (typeof Bun === 'undefined') {
    console.error("Gluegun's dev mode requires the Bun runtime. Please install it: https://bun.sh.")
    console.log('curl -fsSL https://bun.sh/install | bash')
    process.exit(1)
  }

  // kick off gluegun
  require(`${__dirname}/../src/cli/cli`).run(process.argv)
} else {
  require(`${__dirname}/../build/cli/cli`).run(process.argv)
}
